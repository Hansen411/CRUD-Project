<!DOCTYPE html>
<html lang="en">

<head>
  <title>ALA/Employee-Request-Offs</title>
  <link rel="stylesheet" type="text/css" href="CRUD-Styles.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body class="Employee-Dash">
    <div class="dash">
    <section class="menu">
        <nav class="nav-menu">
            <h1>ALA</h1>
            <div class="list">
                <h3>Shift Requests</h3>
            
                <ul>
                    <li><a href="employee-dash.html">Dashboard</a></li>
                    <li><a href="ProfilePage.html">Profile</a></li>
                    <li><a href="E-ShiftRequests.html">Shift Requests</a></li>
                    <li><a href="E-RequestOff.html">Request Offs</a></li>
                    <li><a href="E-Payroll.html">Payroll</a></li>
                    <li><a href="Login.html">Logout</a></li>
                </ul>
                
            </div>
        </nav>
    </section>

    <section class="dashboard-content">
        <div class="mobile-nav">
          
            <div class="dropdown">
                <button class="dropbtn" aria-label="Toggle menu">
                &#9776; <!-- Hamburger icon -->
                </button>
                
                <div class="dropdown-content">
                     <a href="employee-dash.html">Dashboard</a>
                     <a href="ProfilePage.html">Profile</a>
                     <a href="E-ShiftRequests.html">Shift Requests</a>
                     <a href="E-RequestOff.html">Request Offs</a>
                     <a href="E-Payroll.html">Payroll</a>
                     <a href="Login.html">Logout</a>
                </div>
            </div>
            <h1>ALA | Request Off</h1>  
        </div>
        <div class="dashboard-message">
            <h1>Time Off Requests</h1>
            <p>Review and manage your Time Off requests below.</p>
        </div>
       
        <div>
            <div class="employee-requests">
                <div class="request-summary">
                    <h2>Your Time Off Requests</h2>


                <div class="all-requests">
                    <div class="all-requests-header">
                        <h3>All Time Off Requests</h3>
                        <button id="request-button">Make Request</button>
                    </div>
                    
                    <div class="make-request">
                        <form id="request-form">
                            <label for="time-off-type">Time Off Type:</label>
                                <select id="time-off-type" name="time-off-type" required>
                                    <option value="vacation">Vacation</option>
                                    <option value="sick">Sick Leave</option>
                                    <option value="personal">Personal Leave</option>
                                    <option value="other">Other</option>
                                </select>
                            <div>
                                <label for="start-date">Start Date:</label>
                                <input type="date" id="start-date" name="start-date" required>

                                <label for="end-date">End Date:</label>
                                <input type="date" id="end-date" name="end-date" required>
                            </div>
                            <label for="Notes">Notes:</label>
                            <textarea id="Notes" name="reason" rows="4" ></textarea>

                            <button type="submit">Submit Request</button>
                        </form>
                    </div>
                    
                    <hr>
                    <table id="request-table">
                        <thead>
                            <tr>
                                <th>Time Off Type</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Status</th>
                                <th>Notes</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        
<script>

const activeUser = JSON.parse(localStorage.getItem("activeUser"));
if (!activeUser) {
    window.location.href = "Login.html";
}
const userID = activeUser.userID;


document.addEventListener("DOMContentLoaded", function () {
    loadRequestsFromStorage();
    updateCounters();
});


document.getElementById("request-button").addEventListener("click", function () {
    const formSection = document.querySelector(".make-request");
    formSection.style.display = 
        formSection.style.display === "block" ? "none" : "block";
});


document.getElementById("request-form").addEventListener("submit", function(event) {
    event.preventDefault();

    const type = document.getElementById("time-off-type").value;
    const start = document.getElementById("start-date").value;
    const end = document.getElementById("end-date").value;
    const notes = document.getElementById("Notes").value;

    const newRequest = {
        id: Date.now(),
        type,
        start,
        end,
        status: "Pending",
        notes
    };

    saveRequestToLocalStorage(newRequest);
    addRowToTable(newRequest);
    updateCounters();

    document.getElementById("request-form").reset();
    document.querySelector(".make-request").style.display = "none";
});


function saveRequestToLocalStorage(request) {
    const key = `requests_${userID}`;
    const requests = JSON.parse(localStorage.getItem(key)) || [];
    requests.push(request);
    localStorage.setItem(key, JSON.stringify(requests));
}


function loadRequestsFromStorage() {
    const key = `requests_${userID}`;
    const requests = JSON.parse(localStorage.getItem(key)) || [];
    requests.forEach(req => addRowToTable(req));
}


function addRowToTable(request) {
    const tableBody = document.querySelector("#request-table tbody");

    const row = document.createElement("tr");
    row.setAttribute("data-id", request.id);

    row.innerHTML = `
        <td>${request.type}</td>
        <td>${request.start}</td>
        <td>${request.end}</td>
        <td>${request.status}</td>
        <td>${request.notes}</td>
        <td><button class="delete-btn" data-id="${request.id}">Delete</button></td>
    `;

    tableBody.appendChild(row);

    row.querySelector(".delete-btn").addEventListener("click", function () {
        deleteRequest(request.id);
    });
}


function deleteRequest(id) {
    const key = `requests_${userID}`;
    let requests = JSON.parse(localStorage.getItem(key)) || [];
    requests = requests.filter(req => req.id !== id);
    localStorage.setItem(key, JSON.stringify(requests));

    const row = document.querySelector(`tr[data-id="${id}"]`);
    if (row) row.remove();

    updateCounters();
}



</script>






    </section>

    </div>
</body>

</html>