<!DOCTYPE html>
<html lang="en">

<head>
  <title>ALA/Employee-Payroll</title>
  <link rel="stylesheet" type="text/css" href="CRUD-Styles.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body class="Employee-Dash">
    <div class="dash">
        <section class="menu">
            <nav class="nav-menu">
                <h1>ALA</h1>
                <div class="list">
                    <h3>Payroll</h3>
                
                    <ul>
                        <li><a href="employee-dash.html">Dashboard</a></li>
                        <li><a href="ProfilePage.html">Profile</a></li>
                        <li><a href="E-ShiftRequests.html">Shift Requests</a></li>
                        <li><a href="E-RequestOff.html">Request Offs</a></li>
                        <li><a href="E-Payroll.html">Payroll</a></li>
                        <li><a href="Login.html">Logout</a></li>
                    </ul>
                    
                </div>
            </nav>
        </section>

        <section class="dashboard-content">
            <div class="mobile-nav">
          
            <div class="dropdown">
                <button class="dropbtn" aria-label="Toggle menu">
                &#9776; <!-- Hamburger icon -->
                </button>
                
                <div class="dropdown-content">
                     <a href="employee-dash.html">Dashboard</a>
                     <a href="ProfilePage.html">Profile</a>
                     <a href="E-ShiftRequests.html">Shift Requests</a>
                     <a href="E-RequestOff.html">Request Offs</a>
                     <a href="E-Payroll.html">Payroll</a>
                     <a href="Login.html">Logout</a>
                </div>
            </div>
            <h1>ALA | Payroll</h1>  
        </div>
            <div class="dashboard-message">
                <h1>Your Payroll Information</h1>
                <p>Review your recent pay stubs and payment history below.</p>
            </div>
           
            <div class="left-left">
             <div class="payroll-options">
                <div class="pay-top">
                    <div class="paycard" id="paycard-section">
                        <h4>Upcoming Payroll.</h4>
                        <hr>
                        <h3>Bi-Monthly Pay Period</h3>
                        <div id="payweek">
                            
                            <div id="S">
                                <p>Start Date:</p>

                                <p id="start"></p>
                            </div>
                            <div id="S">
                                <p>End Date</p>

                                <p id="end"></p>
                            </div>
                        </div>
                    </div>

                    
                </div>

             </div class="payhist">
                    <div class="paycard">
                    <h4>Payment History</h4>
                    <hr>
                        <table id="takehome">
                                <tr>
                                    <th>Date</th>
                                    <th>Gross</th>
                                    <th>Take Home</th>
                                    <th>Hours:</th>
                                </tr>
                            <tbody></tbody>
                        </table>

                    </div>


             </div>
             
        </section>
    </div>




<script>


// Get active user
const activeUser = JSON.parse(localStorage.getItem("activeUser"));
if (!activeUser) window.location.href = "Login.html";
const userID = activeUser.userID;

// Run functions after DOM is loaded
document.addEventListener("DOMContentLoaded", () => {
    showUpcomingApprovedRequests();
    fillPayPeriodDates();
    buildCalendarWithPTO();
});

// Show upcoming approved PTO requests
function showUpcomingApprovedRequests() {
    const key = `requests_${userID}`;
    const requests = JSON.parse(localStorage.getItem(key)) || [];
    const today = new Date().toISOString().split("T")[0];

    const upcoming = requests
        .filter(req => req.status === "Approved" && req.end >= today)
        .sort((a, b) => new Date(a.start) - new Date(b.start));

    const container = document.getElementById("upcoming-timeoff");
    container.innerHTML = "";

    if (upcoming.length === 0) {
        container.innerHTML = "<p>No upcoming time off.</p>";
        return;
    }

    upcoming.forEach(req => {
        const p = document.createElement("p");
        p.textContent = `${req.start} â†’ ${req.end} (${req.type})`;
        container.appendChild(p);
    });
}

// Fill the current pay period dates
function fillPayPeriodDates() {
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth();

    const startDate = new Date(year, month, 1);
    const endDate = new Date(year, month, 15);

    const options = { year: "numeric", month: "long", day: "numeric" };

    document.getElementById("start").textContent =
        startDate.toLocaleDateString(undefined, options);

    document.getElementById("end").textContent =
        endDate.toLocaleDateString(undefined, options);
}



</script>






</body>
</html>