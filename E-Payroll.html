<!DOCTYPE html>
<html lang="en">

<head>
  <title>ALA/Employee-Payroll</title>
  <link rel="stylesheet" type="text/css" href="CRUD-Styles.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body class="Employee-Dash">
    <div class="dash">
        <section class="menu">
            <nav class="nav-menu">
                <h1>ALA</h1>
                <div class="list">
                    <h3>Payroll</h3>
                
                    <ul>
                        <li><a href="employee-dash.html">Dashboard</a></li>
                        <li><a href="ProfilePage.html">Profile</a></li>
                        <li><a href="E-ShiftRequests.html">Shift Requests</a></li>
                        <li><a href="E-RequestOff.html">Request Offs</a></li>
                        <li><a href="E-Payroll.html">Payroll</a></li>
                        <li><a href="Login.html">Logout</a></li>
                    </ul>
                    
                </div>
            </nav>
        </section>

        <section class="dashboard-content">
            <div class="mobile-nav">
          
            <div class="dropdown">
                <button class="dropbtn" aria-label="Toggle menu">
                &#9776; <!-- Hamburger icon -->
                </button>
                
                <div class="dropdown-content">
                     <a href="employee-dash.html">Dashboard</a>
                     <a href="ProfilePage.html">Profile</a>
                     <a href="E-ShiftRequests.html">Shift Requests</a>
                     <a href="E-RequestOff.html">Request Offs</a>
                     <a href="E-Payroll.html">Payroll</a>
                     <a href="Login.html">Logout</a>
                </div>
            </div>
            <h1>ALA | Payroll</h1>  
        </div>
            <div class="dashboard-message">
                <h1>Your Payroll Information</h1>
                <p>Review your recent pay stubs and payment history below.</p>
            </div>
           
            
             <div class="payroll-options">
                <div class="pay-top">
                    <div class="paycard" id="paycard-section">
                        <h4>Upcoming Payroll.</h4>
                        <hr>
                        <h3>Bi-Monthly Pay Period</h3>
                        <div id="payweek">
                            
                            <div id="S">
                                <p>Start Date:</p>

                                <p id="start"></p>
                            </div>
                            <div id="S">
                                <p>End Date</p>

                                <p id="end"></p>
                            </div>
                        </div>
                    </div>



                    <div class="paycard">
                        <h4>To Do List.</h4>
                        <hr>
                        <p>Congratulations! You have no upcoming tasks at the moment.</p>
                    </div>
                </div>
                <div class="pay-bottom">

                    <div class="paycard">
                        <h4>Upcoming Time Off</h4>
                        <hr>
                        <p id="upcoming-timeoff"></p>
                    </div>

                    <div class="paycard">
                        <h4>Payment History.</h4>
                        <hr>
                        <p id="ph">Dec 5, 2025.</p>
                        <table>
                            <tr>
                                <th>Gross</th>
                                <th>Take Home</th>
                                <th>Hours</th>
                            </tr>
                            <tr>
                                <td>$1,085.46</td>
                                <td>$904.01</td>
                                <td>56.97</td>
                            </tr>
                        </table>
                        <hr>
                        <p id="ph">Nov 21, 2025.</p>
                        <table>
                            <tr>
                                <th>Gross</th>
                                <th>Take Home</th>
                                <th>Hours</th>
                            </tr>
                            <tr>
                                <td>$856.96</td>
                                <td>$729.86</td>
                                <td>46.88</td>
                            </tr>
                        </table>
                        <hr>
                    </div>
                    <div class="paycard">
                        <h4>Calendar</h4>
                        <hr>
                        <div id="calendar"></div>
                    </div>

                </div>
             </div>
        </section>
    </div>




<script>



const activeUser = JSON.parse(localStorage.getItem("activeUser"));
if (!activeUser) window.location.href = "Login.html";
const userID = activeUser.userID;

document.addEventListener("DOMContentLoaded", () => {
    showUpcomingApprovedRequests();
    fillPayPeriodDates();
    buildCalendarWithPTO();
});

 /*requests*/
function showUpcomingApprovedRequests() {
    const key = `requests_${userID}`;
    const requests = JSON.parse(localStorage.getItem(key)) || [];
    const today = new Date().toISOString().split("T")[0];

    const upcoming = requests
        .filter(req => req.status === "Approved" && req.end >= today)
        .sort((a, b) => new Date(a.start) - new Date(b.start));

    const container = document.getElementById("upcoming-timeoff");
    container.innerHTML = "";

    if (upcoming.length === 0) {
        container.innerHTML = "<p>No upcoming time off.</p>";
        return;
    }

    upcoming.forEach(req => {
        const p = document.createElement("p");
        p.textContent = `${req.start} â†’ ${req.end} (${req.type})`;
        container.appendChild(p);
    });
}

 /*pay period days*/
function fillPayPeriodDates() {
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth();

    const startDate = new Date(year, month, 1);
    const endDate = new Date(year, month, 15);

    const options = { year: "numeric", month: "long", day: "numeric" };

    document.getElementById("start").textContent =
        startDate.toLocaleDateString(undefined, options);

    document.getElementById("end").textContent =
        endDate.toLocaleDateString(undefined, options);
}


 /*CALENDAR*/

function buildCalendarWithPTO() {
    const calendarContainer = document.getElementById("calendar");
    const today = new Date();
    const month = today.getMonth();
    const year = today.getFullYear();

    const key = `requests_${userID}`;
    const requests = JSON.parse(localStorage.getItem(key)) || [];
    const approved = requests.filter(req => req.status === "Approved");

    const highlightDates = new Set();

    approved.forEach(req => {
        let start = new Date(req.start);
        let end = new Date(req.end);

        while (start <= end) {
            highlightDates.add(start.toISOString().split("T")[0]);
            start.setDate(start.getDate() + 1);
        }
    });

    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    let html = `<h3>${today.toLocaleString("default", { month: "long" })} ${year}</h3>`;
    html += `
        <table class="calendar-table">
            <tr>
                <th>Su</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th>
            </tr><tr>
    `;

    for (let i = 0; i < firstDay; i++) html += "<td></td>";

    for (let day = 1; day <= daysInMonth; day++) {
        const ds = `${year}-${String(month+1).padStart(2,"0")}-${String(day).padStart(2,"0")}`;
        const highlight = highlightDates.has(ds);

        if ((day + firstDay - 1) % 7 === 0 && day !== 1) html += "</tr><tr>";

        html += `<td class="${highlight ? "pto" : ""}">${day}</td>`;
    }

    html += "</tr></table>";

    calendarContainer.innerHTML = html;
}
</script>






</body>
</html>